<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
        "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="interface">

    <!-- *****************根据渠道信息获取每个栏目的信息发布和信息访问统计******************* -->
    <select id="getPublishSource" resultType="Map">
        SELECT DISTINCT
          publish_source
        FROM
          cs_info
    </select>

    <!-- *****************根据渠道信息获取每个栏目的信息发布和信息访问统计******************* -->
    <select id="getVisitCount" parameterType="Map" resultType="Map">
        SELECT
        day_hits,
        hits,
        total,
        publish_source,
        ca.cat_cname,
        ca.cat_id,
        ca.parent_id,
        ca.cat_position
        FROM
        cs_info_category ca
        LEFT JOIN (
        SELECT
        SUM(day_hits) day_hits,
        sum(hits) hits,
        count(*) total,
        publish_source,
        cat_id
        FROM
        cs_info
        where 1=1
        <if test="date != null">
            and released_dtime >= #{date}
        </if>
        <if test="publish_source != null">
            and (publish_source = 'wx' or publish_source is null)
        </if>
        GROUP BY
        publish_source,
        cat_id
        ) info
        ON ca.cat_id = info.cat_id
        <if test="site_id != null">
            WHERE ca.site_id = #{site_id}
        </if>
        order by ca.cat_id asc
    </select>

    <!-- *****************根据日期获取每个栏目当天的信息发布总量******************* -->
    <select id="getPublishCount" parameterType="Map" resultType="Map">
        SELECT
        total,
        publish_source,
        ca.cat_cname,
        ca.cat_id,
        ca.parent_id,
        ca.cat_position
        FROM
        cs_info_category ca
        LEFT JOIN (
        SELECT
        count(*) total,
        cat_id,publish_source
        FROM
        cs_info
        where 1=1
        <if test="date != null">
            and released_dtime LIKE #{date}
        </if>
        <if test="publish_source != null">
            and (publish_source = 'wx' or publish_source is null)
        </if>
        GROUP BY
        cat_id,publish_source
        ) info
        ON ca.cat_id = info.cat_id
        <if test="site_id != null">
            WHERE ca.site_id = #{site_id}
        </if>
        order by ca.cat_id asc
    </select>

    <!-- 统计访问量排行前十条信息 -->
    <select id="getHotInfoList" parameterType="Map" resultType="com.yinhai.model.HotInfoBean">
        select
        info_id,title,subtitle,top_title,author,editor,source,hits,input_dtime,thumb_url,content_url,released_dtime from
        cs_info where <![CDATA[ rownum <= 10 ]]>
        <if test="site_id != null">and site_id = #{site_id}</if>
        <if test="start_day != null"><![CDATA[ and released_dtime >= #{start_day}]]></if>
        <if test="end_day != null"><![CDATA[ and released_dtime <= #{end_day}]]></if>
        order by hits desc
    </select>

    <select id="getHotInfoList_mysql" parameterType="Map" resultType="com.yinhai.model.HotInfoBean">
        select
        info_id,title,subtitle,top_title,author,editor,source,hits,input_dtime,thumb_url,content_url,released_dtime from
        cs_info where 1=1
        <if test="site_id != null">and site_id = #{site_id}</if>
        <if test="start_day != null"><![CDATA[ and released_dtime >= #{start_day}]]></if>
        <if test="end_day != null"><![CDATA[ and released_dtime <= #{end_day}]]></if>
        order by hits desc limit 0,10
    </select>

    <select id="getHotInfoList_mssql" parameterType="Map" resultType="com.yinhai.model.HotInfoBean">
        select
        info_id,title,subtitle,top_title,author,editor,source,hits,input_dtime,thumb_url,content_url,released_dtime from
        cs_info where 1=1
        <if test="site_id != null">and site_id = #{site_id}</if>
        <if test="start_day != null"><![CDATA[ and released_dtime >= #{start_day}]]></if>
        <if test="end_day != null"><![CDATA[ and released_dtime <= #{end_day}]]></if>
        order by hits desc
    </select>


    <!-- 统计访问量排行前十条信息 -->
    <select id="getInfoListByCatId" parameterType="Map" resultType="com.yinhai.model.HotInfoBean">
        select * from (
        select row_.*, rownum rownum_ from (
        select
        info_id,title,subtitle,top_title,author,editor,source,hits,input_dtime,thumb_url,content_url,released_dtime from
        cs_info
        where info_status = 8 and final_status = 0
        <if test="cat_id != null">and cat_id = #{cat_id}</if>
        <if test="site_id != null">and site_id = #{site_id}</if>
        <if test="publish_source != null">and publish_source like #{publish_source}</if>
        order by released_dtime desc
        <![CDATA[
		        ) row_ where rownum <=#{limit,,jdbcType=INTEGER}+#{start,,jdbcType=INTEGER}
	    	) where rownum_ >=#{start,,jdbcType=INTEGER} + 1
	    ]]>

    </select>

    <!-- 根据栏目id查找该栏目下的信息 -->

    <select id="getInfoListByCatId_mysql" parameterType="Map"
            resultType="com.yinhai.model.HotInfoBean">
        select
        info_id,title,subtitle,top_title,author,editor,source,hits,input_dtime,thumb_url,content_url,released_dtime from
        cs_info
        where info_status = 8 and final_status = 0
        <if test="cat_id != null">and cat_id = #{cat_id}</if>
        <if test="site_id != null">and site_id = #{site_id}</if>
        <if test="publish_source != null">and publish_source like #{publish_source}</if>
        order by released_dtime desc limit #{start,,jdbcType=INTEGER},#{limit,,jdbcType=INTEGER}
    </select>

    <select id="getInfoListByCatId_mssql" parameterType="Map"
            resultType="com.yinhai.model.HotInfoBean">
        select
        info_id,title,subtitle,top_title,author,editor,source,hits,input_dtime,thumb_url,content_url,released_dtime from
        cs_info
        where info_status = 8 and final_status = 0
        <if test="cat_id != null">and cat_id = #{cat_id}</if>
        <if test="site_id != null">and site_id = #{site_id}</if>
        <if test="publish_source != null">and publish_source like #{publish_source}</if>
        order by released_dtime desc
    </select>

    <select id="getInfoListCountByCatId" parameterType="Map" resultType="java.lang.String">
        select  count(*) total from  cs_info
        where info_status = 8 and final_status = 0
        <if test="cat_id != null">and cat_id = #{cat_id}</if>
        <if test="site_id != null">and site_id = #{site_id}</if>
        <if test="publish_source != null">and publish_source like #{publish_source}</if>
    </select>

    <!-- 根据信息id获取信息内容 -->
    <select id="getInfoContentByInfoId" parameterType="Map"
            resultType="com.yinhai.model.HotInfoBean">
        select
        info.info_id,title,subtitle,top_title,author,editor,source,hits,input_dtime,thumb_url,content_url,released_dtime,art.info_content from
        cs_info info left join cs_info_article art on info.info_id = art.info_id
        where info.info_id = #{info_id}
    </select>

</mapper>