<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
        "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="dz_xxbs">
    <resultMap id="BaseResultMap" type="com.deya.project.dz_xxbs.XxbsBean" >
        <id column="id" property="id" jdbcType="INTEGER" />
        <result column="title" property="title" jdbcType="VARCHAR" />
        <result column="do_dept" property="do_dept" jdbcType="INTEGER" />
        <result column="do_dept_name" property="do_dept_name" jdbcType="VARCHAR" />
        <result column="thumb_url" property="thumb_url" jdbcType="VARCHAR" />
        <result column="islink" property="islink" jdbcType="INTEGER" />
        <result column="content_url" property="content_url" jdbcType="VARCHAR" />
        <result column="author" property="author" jdbcType="VARCHAR" />
        <result column="description" property="description" jdbcType="VARCHAR" />
        <result column="keywords" property="keywords" jdbcType="VARCHAR" />
        <result column="editor" property="editor" jdbcType="VARCHAR" />
        <result column="released_dtime" property="released_dtime" jdbcType="VARCHAR" />
        <result column="contents" property="contents" jdbcType="VARCHAR" />
        <result column="info_status" property="info_status" jdbcType="INTEGER" />
        <result column="auto_desc" property="auto_desc" jdbcType="VARCHAR" />
        <result column="cat_id" property="cat_id" jdbcType="INTEGER" />
        <result column="cat_name" property="cat_name" jdbcType="VARCHAR" />
        <result column="input_user" property="input_user" jdbcType="INTEGER" />
        <result column="input_dtime" property="input_dtime" jdbcType="VARCHAR" />
        <result column="modify_user" property="modify_user" jdbcType="INTEGER" />
        <result column="modify_dtime" property="modify_dtime" jdbcType="VARCHAR" />
    </resultMap>

    <insert id="insertXxbs" parameterType="com.deya.project.dz_xxbs.XxbsBean">
        insert into dz_xxbs(
        id,
        title,
        do_dept,
        do_dept_name,
        thumb_url,
        islink,
        content_url,
        author,
        description,
        keywords,
        editor,
        released_dtime,
        contents,
        info_status,
        input_user,
        input_dtime,
        modify_user,
        modify_dtime,
        auto_desc
        ) values(
        ${id},
        #{title},
        ${do_dept},
        #{do_dept_name},
        #{thumb_url},
        ${islink},
        #{content_url},
        #{author},
        #{description},
        #{keywords},
        #{editor},
        #{released_dtime},
        #{contents},
        ${info_status},
        ${input_user},
        #{input_dtime},
        ${modify_user},
        #{modify_dtime},
        #{auto_desc})
    </insert>



    <update id="updateXxbs" parameterType="com.deya.project.dz_xxbs.XxbsBean">
        update dz_xxbs set
        title = #{title},
        do_dept = ${do_dept},
        do_dept_name = #{do_dept_name},
        thumb_url = #{thumb_url},
        islink = ${islink},
        content_url = #{content_url},
        author = #{author},
        description = #{description},
        keywords = #{keywords},
        editor = #{editor},
        released_dtime = #{released_dtime},
        contents = #{contents},
        info_status = ${info_status},
        input_user = ${input_user},
        input_dtime = #{input_dtime},
        modify_user = ${modify_user},
        modify_dtime = #{modify_dtime},
        auto_desc = #{auto_desc}
        where id = ${id}
    </update>



    <update id="updateInfoStatus" parameterType="Map">
        update dz_xxbs set info_status = ${info_status} where id in (${ids})
    </update>

    <update id="updateNoPassStatus" parameterType="Map">
        update dz_xxbs set info_status = 3,auto_desc=#{auto_desc} where id in (${ids})
    </update>

    <update id="infoPass" parameterType="Map">
        update dz_xxbs set info_status = 2,cat_id=${cat_id},cat_name=#{cat_name},auto_desc='' where id in (${ids})
    </update>

    <delete id="deleteXxbs" parameterType="Map">
         delete from dz_xxbs
        <where>
            <if test="ids != null and ids != ''">
                and id in (${ids})
            </if>
        </where>
    </delete>

    <select id="getXxbsInfoList" parameterType="Map" resultMap="BaseResultMap">
      select * from dz_xxbs
        <include refid="getXxbsInfoList_sql_conn"/>
        <if test="orderByFields != null and orderByFields == 1">
            order by released_dtime desc
        </if>
        <if test="orderByFields != null and orderByFields == 2">
            order by released_dtime
        </if>
        limit #{start_num,,jdbcType=INTEGER},#{page_size,,jdbcType=INTEGER}
    </select>


    <select id="getXxbsInfoCount" parameterType="Map" resultType="java.lang.String">
        select count(*) from dz_xxbs
        <include refid="getXxbsInfoList_sql_conn"/>
    </select>

    <select id="getXxbs" parameterType="Map" resultMap="BaseResultMap">
        select * from dz_xxbs where id = ${id}
    </select>

    <sql id="getXxbsInfoList_sql_conn">
        where 1=1
        <if test="search != null and search!=''">
            and title like '%${search}%'
        </if>
        <if test="info_status != null and info_status>0">
            and info_status = #{info_status}
        </if>
        <if test="dept_ids != null and dept_ids!=''">
            and do_dept in (${dept_ids})
        </if>
    </sql>

    <select id="getXxbsDeptCount" parameterType="Map" resultType="java.lang.String">
        <![CDATA[
          select count(*) as totle from dz_xxbs where do_dept=#{do_dept} and info_status=#{info_status} and input_dtime>='${start_time}' and input_dtime<='${end_time}'
        ]]>
    </select>
</mapper>